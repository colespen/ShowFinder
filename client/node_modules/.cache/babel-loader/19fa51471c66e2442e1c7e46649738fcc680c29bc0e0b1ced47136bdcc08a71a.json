{"ast":null,"code":"var _jsxFileName = \"/Users/macbookpro/Documents/Dev/ShowFinder/src/components/Map.jsx\",\n  _s2 = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { MapContainer, TileLayer, useMap, Marker, Popup } from 'react-leaflet';\nimport L from \"leaflet\";\nimport useGeoLocation from '../hooks/useGeoLocation';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Map(props) {\n  _s2();\n  var _s = $RefreshSig$();\n  const [shows, setShows] = useState({});\n  const [currCity, setCurrCity] = useState(null);\n  const geolocation = useGeoLocation();\n  console.log(\"geolocation ~~~~~~~~~~~~; \", geolocation);\n  const hqToken = 'MIUlzyESU3Uvf_ZUQxzFzM0C3vae40bPOYJSMPsN';\n  const iqToken = 'pk.32218541d692e0df20b0912ebadf68bf';\n  const currDate = new Date();\n  const date = `${currDate.getFullYear()}-${currDate.getMonth() + 1}-${currDate.getDate()}`;\n  const lat = geolocation.coords.lat;\n  const lng = geolocation.coords.lng;\n  const egypt = [31.403292642948028, 30.853644619611597];\n  function CurrentLocation() {\n    _s();\n    const map = useMap();\n    console.log(\"~~~~~~~~~~~~~~~map.flyTo(): \", map.flyTo);\n    useEffect(() => {\n      if (geolocation.loaded) map.flyTo(geolocation.coords, 12);\n      //use setView() if page refresh\n      // map.setView(geolocation.coords, map.getZoom());\n      map.on('zoomend', () => {\n        // load position marker after animation\n        const radius = geolocation.accuracy;\n        const circle = L.circle(geolocation.coords, radius);\n        circle.addTo(map);\n      });\n    }, [map]);\n    return null;\n  }\n\n  // fetch city name using coords\n  _s(CurrentLocation, \"IoceErwr5KVGS9kN4RQ1bOkYMAg=\", false, function () {\n    return [useMap];\n  });\n  useEffect(() => {\n    const xhr = new XMLHttpRequest();\n    if (geolocation.loaded) {\n      xhr.open('GET', `https://us1.locationiq.com/v1/reverse.php?key=${iqToken}&lat=` + lat + \"&lon=\" + lng + \"&format=json\", true);\n      xhr.send();\n      xhr.onreadystatechange = processRequest;\n      xhr.addEventListener(\"readystatechange\", processRequest, false);\n    }\n    function processRequest(e) {\n      if (xhr.readyState === 4 && xhr.status === 200) {\n        const response = JSON.parse(xhr.responseText);\n        const city = response.address.city;\n        setCurrCity(city);\n      }\n    }\n  }, [lat, lng, geolocation.loaded]);\n\n  // fetch show data with params\n  useEffect(() => {\n    const options = {\n      method: 'GET',\n      baseURL: 'https://api.predicthq.com/v1/events/',\n      params: {\n        // 'relevance': 'rank,start_around,location_around',\n        // 'start_around.origin': date,\n        // 'location_around.origin': lat + \",\" + lng,\n        // 'location_around.offset': '2km',\n        // 'location_around.scale': '20km',\n        'active.gte': date,\n        'category': 'concerts'\n      },\n      headers: {\n        authorization: `Bearer ${hqToken}`\n      }\n    };\n    if (geolocation.loaded) axios.request(options).then(res => {\n      setShows(res.data);\n      console.log(\"res.data~~~~~~~~~: \", res.data);\n    }).catch(err => {\n      console.error(err.message);\n    });\n  }, [geolocation, date, lat, lng]);\n\n  // results OR empty array seems wrong but need to not map on undefined axios get\n  const showMarkers = (shows.results || []).map(show => show.entities.map(venue => /*#__PURE__*/_jsxDEV(Marker, {\n    position: [show.location[1], show.location[0]],\n    children: /*#__PURE__*/_jsxDEV(Popup, {\n      children: [show.title, \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 24\n      }, this), \" \", venue.name]\n    }, venue.entity_id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }, this)\n  }, show.id, false, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 7\n  }, this)));\n  console.log(\"shows~~~~~~~~~: \", shows);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: [\" \", currCity ? \"Shows in \" + currCity : \"grabbing your location...\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MapContainer, {\n      center: egypt,\n      zoom: 2,\n      scrollWheelZoom: true,\n      children: [showMarkers, /*#__PURE__*/_jsxDEV(TileLayer, {\n        attribution: \"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",\n        url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CurrentLocation, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this);\n}\n_s2(Map, \"82taaAFIQ3GH755YfefwlKsmZ58=\", false, function () {\n  return [useGeoLocation];\n});\n_c = Map;\nvar _c;\n$RefreshReg$(_c, \"Map\");","map":{"version":3,"names":["useState","useEffect","axios","MapContainer","TileLayer","useMap","Marker","Popup","L","useGeoLocation","Map","props","shows","setShows","currCity","setCurrCity","geolocation","console","log","hqToken","iqToken","currDate","Date","date","getFullYear","getMonth","getDate","lat","coords","lng","egypt","CurrentLocation","map","flyTo","loaded","on","radius","accuracy","circle","addTo","xhr","XMLHttpRequest","open","send","onreadystatechange","processRequest","addEventListener","e","readyState","status","response","JSON","parse","responseText","city","address","options","method","baseURL","params","headers","authorization","request","then","res","data","catch","err","error","message","showMarkers","results","show","entities","venue","location","title","name","entity_id","id"],"sources":["/Users/macbookpro/Documents/Dev/ShowFinder/src/components/Map.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { MapContainer, TileLayer, useMap, Marker, Popup } from 'react-leaflet';\nimport L from \"leaflet\";\nimport useGeoLocation from '../hooks/useGeoLocation';\n\n\nexport default function Map(props) {\n  const [shows, setShows] = useState({});\n  const [currCity, setCurrCity] = useState(null);\n  const geolocation = useGeoLocation();\n  console.log(\"geolocation ~~~~~~~~~~~~; \", geolocation);\n\n  const hqToken = 'MIUlzyESU3Uvf_ZUQxzFzM0C3vae40bPOYJSMPsN';\n  const iqToken = 'pk.32218541d692e0df20b0912ebadf68bf';\n\n  const currDate = new Date();\n  const date = `${currDate.getFullYear()}-${currDate.getMonth() + 1}-${currDate.getDate()}`;\n\n  const lat = geolocation.coords.lat;\n  const lng = geolocation.coords.lng;\n\n  const egypt =\n    [31.403292642948028, 30.853644619611597];\n\n\n  function CurrentLocation() {\n    const map = useMap();\n    console.log(\"~~~~~~~~~~~~~~~map.flyTo(): \", map.flyTo)\n    useEffect(() => {\n      if (geolocation.loaded) map.flyTo(geolocation.coords, 12);\n      //use setView() if page refresh\n      // map.setView(geolocation.coords, map.getZoom());\n      map.on('zoomend', () => {\n        // load position marker after animation\n        const radius = geolocation.accuracy;\n        const circle = L.circle(geolocation.coords, radius);\n        circle.addTo(map);\n      })\n    }, [map]);\n    return null;\n  }\n  \n  // fetch city name using coords\n  useEffect(() => {\n    const xhr = new XMLHttpRequest();\n    if (geolocation.loaded) {\n      xhr.open('GET',\n        `https://us1.locationiq.com/v1/reverse.php?key=${iqToken}&lat=`\n        + lat + \"&lon=\" + lng + \"&format=json\", true);\n      xhr.send();\n      xhr.onreadystatechange = processRequest;\n      xhr.addEventListener(\"readystatechange\", processRequest, false);\n    }\n    function processRequest(e) {\n      if (xhr.readyState === 4 && xhr.status === 200) {\n        const response = JSON.parse(xhr.responseText);\n        const city = response.address.city;\n        setCurrCity(city);\n      }\n    }\n  }, [lat, lng, geolocation.loaded]);\n\n  // fetch show data with params\n  useEffect(() => {\n    const options = {\n      method: 'GET',\n      baseURL: 'https://api.predicthq.com/v1/events/',\n      params: {\n        // 'relevance': 'rank,start_around,location_around',\n        // 'start_around.origin': date,\n        // 'location_around.origin': lat + \",\" + lng,\n        // 'location_around.offset': '2km',\n        // 'location_around.scale': '20km',\n        'active.gte': date,\n        'category': 'concerts'\n      },\n      headers: {\n        authorization: `Bearer ${hqToken}`\n      }\n    };\n    if (geolocation.loaded) axios.request(options)\n      .then(res => {\n        setShows(res.data);\n        console.log(\"res.data~~~~~~~~~: \", res.data);\n      })\n      .catch(err => {\n        console.error(err.message);\n      });\n  }, [geolocation, date, lat, lng]);\n\n\n  // results OR empty array seems wrong but need to not map on undefined axios get\n  const showMarkers = (shows.results || []).map(show => (\n    show.entities.map(venue => (\n\n      <Marker\n        key={show.id}\n        position={[show.location[1], show.location[0]]}>\n        <Popup key={venue.entity_id}>\n          {show.title} <br /> {venue.name}\n        </Popup>\n      </Marker>\n    ))\n  ));\n\n  console.log(\"shows~~~~~~~~~: \", shows);\n\n  return (\n    <div>\n      <h1> {currCity ? \"Shows in \" +\n        currCity : \"grabbing your location...\"}\n      </h1>\n\n      <MapContainer\n        center={egypt}\n        zoom={2} scrollWheelZoom={true} \n      >\n        {showMarkers}\n\n        <TileLayer\n          attribution=\n          '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        <CurrentLocation />\n      </MapContainer>\n    </div>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}